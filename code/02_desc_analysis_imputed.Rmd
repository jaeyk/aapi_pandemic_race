---
title: "Descriptive analysis (imputed)"
author: "Jae Yeon Kim"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
---

# Load packages 

```{r}
if (!require(pacman)) install.packages("pacman")

pacman::p_load(
  tidyverse, # tidyverse
  plm, # panel data analysis
  pglm, # generalized panel data analysis
  clubSandwich, # robust SEs
  here, # computational reproducibility
  glue, # gluing objects and strings
  tidylog, # logging analysis
  naniar, # missing data
  zeallot, # multiple assignments
  readxl,
  ggpubr,
  hrbrthemes,
  wesanderson,
  broom,
  sjPlot,
  jtools,
  patchwork,
  broom.mixed,
  estimatr,
  stargazer,
  DeclareDesign,
  sensemakr,
  mice,
  usmap,
  janitor,
  modelsummary,
  flextable,
  officer,
  extrafont,
  gt,
  bootstrap,
  lme4,
  clipr,
  infer
)

source(here("functions/utils.r"))
source(here("functions/theme.R"))

ggplot2::theme_set(theme_bw())

# no scientific notation
options(scipen = 999)
```

# Load files 

```{r message = FALSE}
df <- read_csv(here("processed_data", "panel_data_cleaned.csv"))[, -c(1:2)]
```

# Measurement check 

```{r}
df2 <- subset(df, wave == 2)

t.test(subset(df, wave == 2)$apa.discrim.rona, subset(df, wave == 3)$apa.discrim.rona)

ch_score <- data.frame(ch_score = subset(df, wave == 2)$apa.discrim.rona - subset(df, wave == 3)$apa.discrim.rona)

ch_score %>%
  ggplot(aes(x = ch_score)) +
  geom_bar() +
  scale_x_binned() +
  labs(
    x = "Change score between waves 2 and 3",
    y = "Count"
  )

ggsave(here("outputs", "ch_score.png"))

dv <- subset(df, wave == 1)$gendiscrim

covat2 <- df %>%
  filter(wave == 2) %>%
  select(apa.discrim.rona, usborn, edu, DEM, GOP, age, male, chinese, indian)

covat3 <- df %>%
  filter(wave == 3) %>%
  select(apa.discrim.rona, usborn, edu, DEM, GOP, age, male, chinese, indian)

covat2$gendiscrim <- dv
covat3$gendiscrim <- dv
```

```{r}
# factorize dummy variables
covat2 <- factorize_dummy(covat2)
covat3 <- factorize_dummy(covat3)

mods_exo <- list(
  "2nd wave" = lm(apa.discrim.rona ~ gendiscrim + usborn + edu + DEM + GOP + age + male + chinese + indian, data = covat2),
  "3rd wave" = lm(apa.discrim.rona ~ gendiscrim + usborn + edu + DEM + GOP + age + male + chinese + indian, data = covat3)
)
```

```{r}
modelsummary(mods_exo, output = "gt")
```

```{r}
modelsummary(mods_exo,
  fmt = 3,
  coef_omit = "Intercept",
  statistic = c("p = {p.value}"),
  stars = TRUE,
  output = here("outputs", "reg_exo.docx"),
  coef_rename =
    c(
      "gendiscrim" = "General discrimination",
      "apa.discrim.rona" = "COVID-19 discrimination",
      "usborn1" = "US born",
      "edu" = "Education",
      "DEM1" = "Democratic Party",
      "GOP1" = "Republican Party",
      "age" = "Age",
      "male1" = "Male",
      "chinese1" = "Chinese",
      "indian1" = "Indian"
    ),
  vcov = "robust"
)
```

# Summarize by group 

## Different partisans

```{r}
dodge <- position_dodge(width = 0.9)

party1 <- df %>%
  group_by(wave, party.id) %>%
  count() %>%
  ggplot(aes(x = wave, y = n, fill = party.id)) +
  geom_col(position = dodge)

party2 <- df %>%
  mutate(party.id = if_else(party.id %in% c("Democrat", "Republican") | is.na(party.id), party.id, "Independent or Other")) %>%
  group_by(wave, party.id) %>%
  count() %>%
  ggplot(aes(x = wave, y = n, fill = party.id)) +
  geom_col(position = dodge)

party1 / party2 + plot_annotation(tag_levels = )
```

```{r}
var.list <- names(df)[str_detect(names(df), "disc")][c(1, 3)]

# rescale the discrimination perception variables
df$apa.discrim.rona <- df$apa.discrim.rona - .5
df$gendiscrim <- df$gendiscrim - .5

var.list <- c(var.list, c("linkedfate", "idimport", "asnpride", "rona.behav.sneeze", "rona.behav.language", "rona.behav.walk", "rona.behav.transit", "rona.behav.other", "rona.behav.nochange", "2020likelyvote", "biden", "DEM", "DEM.strong", "GOP", "GOP.strong", "ronaunfair", "ronaunfairasian", "rona.apa.mistreat", "apa.responsible", "apa.have.rona", "apa.harassment", "whiteaffect", "blackaffect", "latinoaffect", "asianaffect"))

group_sum <- purrr::map_dfr(seq(var.list), group_mean) %>%
  mutate(variable = rep(var.list, each = 3)) %>%
  filter(!is.na(mean))
```

## Discrimination perception 

```{r}
group_sum %>%
  filter(str_detect(variable, "disc")) %>%
  mutate(variable = recode(variable,
    "apa.discrim.rona" = "COVID-19 discrimination",
    "gendiscrim" =
      "General discrimination"
  )) %>%
  ggplot(aes(
    x = glue("{factor(wave_fac)} 2020"), y = mean,
    ymax = mean + ci_high,
    ymin = mean - ci_low
  )) +
  geom_errorbar() +
  geom_col(alpha = 0.5) +
  # ggrepel::geom_text_repel(aes(label = glue("{round(mean, 3)*100}%", position = dodge), width = 0.25, col = "red")) +
  facet_wrap(~variable) +
  labs(
    title = "Changes in discrimination perception",
    x = "", y = "Average response"
  ) +
  geom_hline(yintercept = 0, linetype = "dotted", col = "red", size = 1) +
  theme(legend.position = "none")
ggsave(here("outputs", "disc.perception.png"),
  width = 10,
  height = 7
) +
  ylim(c(-.5, .5))

ggsave(here("outputs", "diff.png"))
```

```{r}
gen_density <- df %>%
  ggplot(aes(gendiscrim)) +
  geom_density() +
  facet_wrap(~wave_fac) +
  labs(
    x = "Response",
    y = "Density",
    title = "General discrimination"
  ) +
  geom_vline(xintercept = 0, linetype = "dotted", col = "red", size = 1)

rona_density <- df %>%
  ggplot(aes(apa.discrim.rona)) +
  geom_density() +
  facet_wrap(~wave_fac) +
  labs(
    x = "Response",
    y = "Density",
    title = "COVID-19 discrimination"
  ) +
  geom_vline(xintercept = 0, linetype = "dotted", col = "red", size = 1)

(gen_density / rona_density) + plot_annotation(tag_levels = "A")

ggsave(here("outputs", "density.png"))
```

```{r}
df$proxy <- rep(subset(df, wave == 1)$gendiscrim, 3)
```

```{r}
plot_w12 <- df %>%
  filter(wave %in% c(1, 2)) %>%
  group_by(proxy) %>%
  summarise(
    mean = mean(apa.discrim.rona, na.rm = TRUE),
    ci_high = ci.high(apa.discrim.rona),
    ci_low = ci.low(apa.discrim.rona)
  ) %>%
  mutate(group = 2)

plot_w13 <- df %>%
  filter(wave %in% c(1, 3)) %>%
  group_by(proxy) %>%
  summarise(
    mean = mean(apa.discrim.rona, na.rm = TRUE),
    ci_high = ci.high(apa.discrim.rona),
    ci_low = ci.low(apa.discrim.rona)
  ) %>%
  mutate(group = 3)

plot_w123 <- bind_rows(plot_w12, plot_w13)
```


```{r}
plot_w123 %>%
  ggplot(aes(
    x = factor(proxy), y = mean,
    ymax = mean + ci_high,
    ymin = mean - ci_low,
    col = factor(group)
  )) +
  geom_pointrange() +
  # ggrepel::geom_text_repel(aes(label = round(mean, 2), y = mean), size = 5, vjust = -.5) +
  labs(
    x = "Response to general discrimination Q in W1",
    y = "Average response to COVID-19 discrimination Q in W2 & W3",
    col = "Wave"
  ) +
  geom_hline(yintercept = 0, linetype = "dotted", col = "red", size = 1) +
  #        facet_wrap(~group) +
  # scale_fill_brewer(palette = "Set1") +
  # theme(legend.position =  "down") +
  ylim(c(-.5, .5))

ggsave(here("outputs", "disc.wave.png"), height = 6)
```

## Affect 

```{r}
group_sum %>%
  filter(wave_fac != "November") %>%
  filter(str_detect(variable, "affect")) %>%
  mutate(variable = recode(variable,
    "asianaffect" = "Asian",
    "latinoaffect" = "Latino",
    "blackaffect" = "Black",
    "whiteaffect" = "White"
  )) %>%
  mutate(mean = round(mean, 2)) %>%
  ggplot(aes(
    x = wave_fac, y = mean,
    ymax = mean + ci_high,
    ymin = mean - ci_low,
    col = variable
  )) +
  geom_pointrange() +
  labs(
    x = "", y = "Average response",
    col = "Affect"
  ) +
  geom_hline(yintercept = 3.5, linetype = "dotted", col = "red", size = 1) +
  scale_colour_brewer(palette = "Set1")
ggsave(here("outputs", "affect.png"))
```

```{r}
group_sum %>%
  filter(wave_fac == "May") %>%
  filter(str_detect(variable, "rona")) %>%
  filter(!str_detect(variable, "apa|nochange|2020|biden|DEM|GOP|fair|affect")) %>%
  mutate(variable = recode(variable,
    "rona.behav.sneeze" = "Avoid coughing/sneezing",
    "rona.behav.language" =
      "Avoid speaking Asian language",
    "rona.behav.walk" = "Avoid walking in neighborhoods",
    "rona.behav.transit" = "Avoid public transporation",
    "rona.behav.other" = "Others",
    "rona.index" = "Average response"
  )) %>%
  mutate(mean = mean * 100) %>%
  ggplot(aes(
    x = factor(variable), y = mean,
    ymax = mean + ci_high,
    ymin = mean - ci_low
  )) +
  geom_pointrange() +
  ggrepel::geom_text_repel(aes(label = paste0(round(mean, 2), "%"))) +
  labs(
    title = "COVID-19 related marginalized experience (Wave 2)",
    x = "", y = "Percentage"
  ) +
  coord_flip() +
  scale_y_continuous(labels = ~ paste0(., "%"))
ggsave(here("outputs", "rona_behave.png"), width = 10)
```

```{r}
group_sum %>%
  # filter(wave_fac == "May") %>%
  filter(str_detect(variable, "ronaunfair")) %>%
  mutate(variable = recode(variable,
    "ronaunfairasian" = "Experienced COVID discrimination due to race",
    "ronaunfair" = "Experienced COVID-19 discrimination"
  )) %>%
  mutate(mean = mean * 100) %>%
  ggplot(aes(
    x = wave_fac, y = mean,
    ymax = mean + ci_high * 100,
    ymin = mean - ci_low * 100
  )) +
  geom_pointrange() +
  ggrepel::geom_text_repel(aes(label = paste0(round(mean, 2), "%"))) +
  labs(
    title = "COVID-19 related unfair treatment",
    x = "", y = "Percentage"
  ) +
  facet_wrap(~variable) +
  scale_y_continuous(labels = ~ paste0(., "%"))
ggsave(here("outputs", "rona_fair.png"), width = 12)
```

```{r}
# Lost job
lost_job_pct <- sum(!is.na(df %>%
  filter(wave == 2) %>%
  pull(lostjob))) / (df %>% filter(wave == 2) %>% nrow()) %>%
  round(2)

round(lost_job_pct, 4) * 100
```

5.57% participants in the wave 2 lost jobs. 

```{r}
income_reduction_pct <- sum(!is.na(df %>%
  filter(wave == 2) %>%
  pull(incomereduc))) / (df %>% filter(wave == 2) %>% nrow()) %>%
  round(2)
round(income_reduction_pct, 4) * 100
```

```{r}
df2 <- df2 %>%
  mutate(
    apa.discrim.rona = replace_na(apa.discrim.rona, 0),
    lostjob = replace_na(lostjob, 0),
    incomereduc = replace_na(incomereduc, 0),
    ronaunfairasian = replace_na(ronaunfairasian, 0),
    rona.apa.mistreat = replace_na(rona.apa.mistreat, 0)
  )

mod1 <- lm(apa.discrim.rona ~ lostjob + incomereduc, data = df2)
mod2 <- lm(apa.discrim.rona ~ ronaunfairasian, data = df2)
mod3 <- lm(apa.discrim.rona ~ rona.apa.mistreat, data = df2)

set.seed(1234)
modelsummary(list(`Hardship` = mod1, `Experience` = mod2, `Witnesing` = mod3),
  fmt = 4,
  coef_omit = "Intercept",
  statistic = c("p = {p.value}"),
  stars = TRUE,
  vcov = "robust",
  output = here("outputs", "reg_measure.docx")
)
```

## Party ID

```{r}
dodge <- position_dodge(width = 0.9)

group_sum %>%
  filter(variable %in% c("DEM", "GOP")) %>%
  ggplot(aes(
    x = glue("{factor(wave_fac)} 2020"), y = mean,
    ymax = mean + ci_high,
    ymin = mean - ci_low
  )) +
  geom_errorbar() +
  geom_col(alpha = 0.5) +
  # ggrepel::geom_text_repel(aes(label = glue("{round(mean, 3)*100}%", position = dodge), width = 0.25, col = "red")) +
  facet_wrap(~variable) +
  labs(
    title = "Changes in discrimination perception",
    x = "", y = "Average response"
  ) +
  geom_hline(yintercept = 0, linetype = "dotted", col = "red", size = 1) +
  theme(legend.position = "none")
ggsave(here("outputs", "disc.perception.png"),
  width = 10,
  height = 7
) +
  ylim(c(-.5, .5))

ggsave(here("outputs", "party_diff.png"))
```

# Regression analysis

## Imputation

```{r}
df_na_sum <- df %>%
  filter(wave != 1) %>%
  select(`2020likelyvote`, biden, gendiscrim, apa.discrim.rona, usborn, edu, income, DEM, GOP, age, male, wave, korean, chinese) %>%
  map_dfr(~ is.na(.) %>% mean())
```

```{r}
imp <- mice(
  df %>%
    filter(wave != 1) %>%
    select(gendiscrim, apa.discrim.rona, usborn, edu, income, DEM, GOP, age, male, wave, korean, chinese),
  seed = 1234, # for reproducibility
  m = 5, # the number of imputations
  maxit = 10, # the max number of iterations
  method = "pmm", # predictive mean method
  print = FALSE
)

densityplot(imp, layout = c(1, 2))

imputed <- mice::complete(imp)
```

```{r}
# Replace with the imputed values

index <- 665:nrow(df)

df$apa.discrim.rona[index] <- imputed$apa.discrim.rona
df$gendiscrim[index] <- imputed$gendiscrim
df$DEM[index] <- imputed$DEM
df$GOP[index] <- imputed$GOP
df$age[index] <- imputed$age
```

```{r}
df %>%
  filter(wave != 1) %>%
  select(gendiscrim, apa.discrim.rona, usborn, edu, DEM, GOP, age, male, natorigin, biden, `2020likelyvote`) %>%
  vis_miss()
```

## Likely to vote 

```{r}
# rename the DV
df$likely_vote <- df$`2020likelyvote`

# rescale the discrimination perception variables
df$apa.discrim.rona <- df$apa.discrim.rona + .5
df$gendiscrim <- df$gendiscrim + .5

# create a proxy variable
df$proxy <- rep(subset(df, wave == 1)$gendiscrim, 3)

## check the proxy data distribution
df$proxy %>% table()

df$prior[df$proxy == 0.5] <- "Middle"
df$prior[df$proxy < 0.5] <- "Low"
df$prior[df$proxy > 0.5] <- "High"

min(df$proxy)
max(df$proxy)
```

Group definition 

    - Middle = 0.5  
    - 1 >= High > 0.5 
    - 0 <= Low < 0.5 

```{r}
# create factor variables

## covariates
df$usborn <- factor(df$usborn)
df$male <- factor(df$male)
df$chinese <- factor(df$chinese)
df$indian <- factor(df$indian)
df$GOP <- factor(df$GOP)
df$DEM <- factor(df$DEM)
df$wave <- factor(df$wave)
df$nat_origin <- factor(df$natorigin)
```

```{r}
model.outs <- cal_model_outputs(df)
model.outs.low <- cal_model_outputs(df %>% filter(prior == "Low"))
model.outs.middle <- cal_model_outputs(df %>% filter(prior == "Middle"))
model.outs.high <- cal_model_outputs(df %>% filter(prior == "High"))
```

### Table 1

```{r}
models <- list(
  "OLS" = lm(likely_vote ~ apa.discrim.rona + gendiscrim + usborn + edu + DEM + GOP + age + male + wave + nat_origin, data = df),
  "Weighted OLS" = lm(likely_vote ~ apa.discrim.rona + gendiscrim + usborn + edu + DEM + GOP + age + male + wave + nat_origin, data = df, weight = weights),
  "Within estimator" = plm(likely_vote ~ apa.discrim.rona + gendiscrim + usborn + edu + DEM + GOP + age + male + nat_origin, data = df, index = c("pid", "wave"), model = "within"),
  "Interaction term" = lm(likely_vote ~ apa.discrim.rona + gendiscrim + proxy + apa.discrim.rona:proxy + usborn + edu + DEM + GOP + age + male + wave + nat_origin, data = df)
)
```

```{r}
modelsummary(models,
  fmt = 3,
  coef_omit = "Intercept|nat_origin",
  statistic = c("p = {p.value}"),
  output = here("outputs", "reg_tb1.docx"),
  coef_rename =
    c(
      "gendiscrim" = "General discrim (post-COVID)",
      "apa.discrim.rona" = "COVID-19 discrim",
      "proxy" = "General Discrim (pre-COVID)",
      "usborn1" = "US born",
      "edu" = "Education",
      "DEM1" = "Democratic Party",
      "GOP1" = "Republican Party",
      "age" = "Age",
      "male1" = "Male",
      "wave3" = "Wave 3",
      "chinese1" = "Chinese",
      "indian1" = "Indian"
    ),
  vcov = "robust"
)
```

### Sensitivity analysis

```{r}
sense.out <- sensemakr(
  model = lm(likely_vote ~ gendiscrim + apa.discrim.rona + usborn + edu + DEM + GOP + age + male + wave + chinese + indian, data = df),
  treatment = "apa.discrim.rona",
  benchmark_covariates = "usborn1",
  kd = 1:3,
  ky = 1:3,
  q = 1
)

main.sense <- summary(sense.out) %>%
  flextable() %>%
  set_table_properties(layout = "autofit", width = .8)

main.tmp <- tempfile(fileext = ".docx")

# Create a docx file
read_docx() %>%
  body_add_flextable(main.sense) %>%
  print(target = main.tmp)

browseURL(main.tmp)
```

## Biden candidacy

### Table 2

```{r}
biden.models <- list(
  "Logit" = glm(biden ~ apa.discrim.rona + gendiscrim + usborn + edu + DEM + GOP + age + male + wave + nat_origin, data = df, family = binomial),
  "Weighted logit" = glm(biden ~ apa.discrim.rona + gendiscrim + usborn + edu + DEM + GOP + age + male + wave + nat_origin, data = df, family = binomial, weight = weights),
  "Within estimator" = plm(biden ~ apa.discrim.rona + gendiscrim + usborn + edu + DEM + GOP + age + male + wave + nat_origin, data = df, index = c("pid", "wave"), model = "within", family = binomial),
  "Interaction term" = glm(biden ~ apa.discrim.rona + gendiscrim + proxy + apa.discrim.rona:proxy + usborn + edu + DEM + GOP + age + male + wave + nat_origin, data = df, weight = weights, family = binomial)
)
```

```{r}
modelsummary(biden.models,
  fmt = 3,
  coef_omit = "Intercept|nat_origin",
  statistic = c("p = {p.value}"),
  output = here("outputs", "reg_tb2.docx"),
  coef_rename =
    c(
      "gendiscrim" = "General discrim (post-COVID)",
      "apa.discrim.rona" = "COVID-19 discrim",
      "proxy" = "General Discrim (pre-COVID)",
      "usborn1" = "US born",
      "edu" = "Education",
      "DEM1" = "Democratic Party",
      "GOP1" = "Republican Party",
      "age" = "Age",
      "male1" = "Male",
      "wave3" = "Wave 3",
      "chinese1" = "Chinese",
      "indian1" = "Indian"
    ),
  vcov = "robust"
)
```
### Sensitivity analysis

```{r}
sense.out.biden <- sensemakr(
  model = lm(biden ~ gendiscrim + apa.discrim.rona + usborn + edu + DEM + GOP + age + male + wave + chinese + indian, data = df),
  treatment = "apa.discrim.rona",
  benchmark_covariates = "DEM1",
  kd = 1:3,
  ky = 1:3,
  q = 1
)

biden.sense <- summary(sense.out.biden) %>%
  flextable() %>%
  set_table_properties(layout = "autofit", width = .8)

biden.tmp <- tempfile(fileext = ".docx")

# Create a docx file
read_docx() %>%
  body_add_flextable(biden.sense) %>%
  print(target = biden.tmp)

browseURL(biden.tmp)
```


```{r}
sense_series <- c(
  model %>%
    tidy() %>%
    filter(term == "apa.discrim.rona") %>%
    select(estimate) %>%
    pull(estimate),
  run_sense(model) %>%
    tibble() %>%
    select(contains("Adjusted Estimate")) %>%
    pull(`Adjusted Estimate`)
)

bench <- model %>%
  tidy() %>%
  filter(term == "DEM") %>%
  select(estimate) %>%
  pull(estimate)

1 - (sense_series[1] - sense_series[4]) / sense_series[1]
bench
1 - (sense_series[1] - sense_series[4]) / sense_series[1] > bench

run_sense(model) %>%
  tibble() %>%
  gt()
```

## Interaction terms 

```{r}
turnout_int_mod <- list(
  "Interaction term (Turnout)" = lm(likely_vote ~ gendiscrim + apa.discrim.rona + proxy + apa.discrim.rona:proxy + usborn + edu + DEM + GOP + age + male + wave, data = df, weight = weights),
  "Interaction term with national origin dummies (Turnout)" = lm(likely_vote ~ gendiscrim + apa.discrim.rona + proxy + apa.discrim.rona:proxy + usborn + edu + DEM + GOP + age + male + wave + nat_origin, data = df, weight = weights)
)

biden_int_mod <- list(
  "Interaction term (Biden candidacy)" = glm(biden ~ gendiscrim + apa.discrim.rona + proxy + apa.discrim.rona:proxy + usborn + edu + DEM + GOP + age + male + wave, data = df, family = binomial, weight = weights),
  "Interaction term with national origin dummies (Biden candidacy)" = glm(biden ~ gendiscrim + apa.discrim.rona + proxy + apa.discrim.rona:proxy + usborn + edu + DEM + GOP + age + male + wave + nat_origin, data = df, family = binomial, weight = weights)
)

fit <- glm(biden ~ gendiscrim + apa.discrim.rona + proxy + apa.discrim.rona:proxy + usborn + edu + DEM + GOP + age + male + wave + nat_origin, data = df, family = binomial, weight = weights)
```

```{r}
plot_model(fit,
  type = "pred",
  terms = c("apa.discrim.rona", "proxy"),
  color = viridis::plasma(n = 5)
) +
  labs(
    title = glue("Predicted probabilities of support for Democratic candidate Biden"),
    col = "Pre-COVID general discriminatin perception",
    x = "COVID discrimination perception",
    y = "Predicted probabilities"
  ) +
  theme(legend.position = "bottom")

ggsave(here("outputs", "pred_biden.png"), width = 7, height = 7)
```

```{r}
modelsummary(turnout_int_mod,
  exponentiate = TRUE,
  fmt = 3,
  coef_omit = "Intercept|nat_origin",
  statistic = c("p = {p.value}"),
  output = here("outputs", "turnout_int_mod.docx")
)

modelsummary(biden_int_mod,
  fmt = 3,
  coef_omit = "Intercept|nat_origin",
  statistic = c("p = {p.value}"),
  output = here("outputs", "biden_int_mod.docx")
)
```

## Correlates

```{r}
modelplot(lm(gendiscrim ~ usborn + edu + income + DEM + GOP + age + male, data = subset(df, wave == 1)),
  coef_omit = "Intercept",
  vcov = "robust",
  coef_rename =
    c(
      "usborn1" = "US born",
      "edu" = "Education",
      "income" = "Income",
      "DEM1" = "Democratic Party",
      "GOP1" = "Republican Party",
      "age" = "Age",
      "male1" = "Male"
    )
) +
  geom_vline(xintercept = 0, col = "red", linetype = "dashed") +
  theme_classic()

ggsave(here("outputs", "correlate_gen.png"))
```

```{r}
modelplot(lm(apa.discrim.rona ~ usborn + edu + DEM + GOP + age + male + wave_fac, data = subset(df, wave != 1)),
  coef_omit = "Intercept",
  vcov = "robust",
  coef_rename =
    c(
      "usborn1" = "US born",
      "edu" = "Education",
      # "income" = "Income",
      "DEM1" = "Democratic Party",
      "GOP1" = "Republican Party",
      "age" = "Age",
      "male1" = "Male",
      "wave_facNovember" = "Wave 3"
    )
) +
  geom_vline(xintercept = 0, col = "red", linetype = "dashed") +
  theme_classic()

ggsave(here("outputs", "correlate_covid.png"))
```
